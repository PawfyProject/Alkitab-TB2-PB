<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Alkitab Perjanjian Baru - TB2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom styles for select arrow for better appearance */
    select {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='white'%3e%3cpath stroke-linecap='round' stroke-linejoin='round' d='m19.5 8.25-7.5 7.5-7.5-7.5'/%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 0.75rem center;
      background-size: 1.5em 1.5em;
      padding-right: 2.5rem; /* Make space for the custom arrow */
    }
  </style>
</head>
<body class="min-h-screen bg-black text-white flex flex-col items-center justify-center p-4 font-serif font-bold">

  <h1 class="text-4xl md:text-5xl font-extrabold mb-8 text-center drop-shadow-lg">
    Alkitab Perjanjian Baru - TB2
  </h1>

  <div id="loadingMessage" class="text-lg mb-4 hidden drop-shadow">Memuat data Alkitab...</div>
  <div id="errorMessage" class="text-lg mb-4 hidden drop-shadow"></div>

  <div id="mainContent" class="hidden flex flex-col items-center justify-center w-full">
    <div class="flex flex-col md:flex-row items-center justify-center gap-4 mb-8 w-full max-w-2xl">
      <select id="bookSelect"
        class="p-3 bg-transparent border border-gray-600 rounded-lg text-white appearance-none focus:outline-none focus:ring-2 focus:ring-white hover:border-white transition duration-200 w-full md:w-auto">
      </select>

      <select id="chapterSelect"
        class="p-3 bg-transparent border border-gray-600 rounded-lg text-white appearance-none focus:outline-none focus:ring-2 focus:ring-white hover:border-white transition duration-200 w-full md:w-auto">
      </select>

      <select id="verseSelect"
        class="p-3 bg-transparent border border-gray-600 rounded-lg text-white appearance-none focus:outline-none focus:ring-2 focus:ring-white hover:border-white transition duration-200 w-full md:w-auto">
      </select>
    </div>

    <div class="flex gap-4 mb-8">
      <button onclick="goToPrevVerse()"
        class="p-3 border border-gray-500 hover:border-white text-white rounded-full shadow-lg focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-75 transition duration-300 transform active:scale-95 text-xl flex items-center justify-center w-12 h-12"
        aria-label="Previous Verse">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m12 19-7-7 7-7" />
          <path d="M19 12H5" />
        </svg>
      </button>
      <button onclick="goToNextVerse()"
        class="p-3 border border-gray-500 hover:border-white text-white rounded-full shadow-lg focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-75 transition duration-300 transform active:scale-95 text-xl flex items-center justify-center w-12 h-12"
        aria-label="Next Verse">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12h14" />
          <path d="m12 5 7 7-7 7" />
        </svg>
      </button>
    </div>

    <div id="verseDisplay"
      class="verse-display border border-gray-600 p-8 rounded-xl max-w-4xl w-full text-center min-h-[150px] flex items-center justify-center">
      <p class="text-xl drop-shadow">Pilih Kitab, Pasal, dan Ayat</p>
    </div>
  </div>

  <script>
    let bibleData = {};
    let currentBook = "";
    let currentChapter = "";
    let currentVerse = "";

    // Get references to DOM elements
    const bookSelect = document.getElementById("bookSelect");
    const chapterSelect = document.getElementById("chapterSelect");
    const verseSelect = document.getElementById("verseSelect");
    const verseDisplay = document.getElementById("verseDisplay");
    const loadingMessage = document.getElementById("loadingMessage");
    const errorMessage = document.getElementById("errorMessage");
    const mainContent = document.getElementById("mainContent");

    // Function to fetch and load the Bible data from alkitab_pb.json
    async function loadBible() {
      loadingMessage.classList.remove('hidden'); // Show loading message
      mainContent.classList.add('hidden'); // Hide main content
      errorMessage.classList.add('hidden'); // Hide any previous error messages

      try {
        const res = await fetch("alkitab_pb.json");
        if (!res.ok) {
          throw new Error(`HTTP error! status: ${res.status}`);
        }
        bibleData = await res.json();
        populateBooks(); // Populate book dropdown
        // Initialize current selections after data is loaded and dropdowns are populated
        if (Object.keys(bibleData).length > 0) {
          currentBook = Object.keys(bibleData)[0];
          bookSelect.value = currentBook;
          populateChapters();
          if (Object.keys(bibleData[currentBook]).length > 0) {
            currentChapter = Object.keys(bibleData[currentBook])[0];
            chapterSelect.value = currentChapter;
            populateVerses();
            if (Object.keys(bibleData[currentBook][currentChapter]).length > 0) {
              currentVerse = Object.keys(bibleData[currentBook][currentChapter])[0];
              verseSelect.value = currentVerse;
            }
          }
        }
        showVerse(); // Display the first verse
      } catch (e) {
        console.error("Failed to load Bible data:", e);
        errorMessage.textContent = "Gagal memuat data Alkitab. Pastikan 'alkitab_pb.json' ada dan benar.";
        errorMessage.classList.remove('hidden'); // Show error message
      } finally {
        loadingMessage.classList.add('hidden'); // Hide loading message
        mainContent.classList.remove('hidden'); // Show main content
      }
    }

    // Populates the book selection dropdown
    function populateBooks() {
      bookSelect.innerHTML = ""; // Clear existing options
      Object.keys(bibleData).forEach(book => {
        bookSelect.add(new Option(book, book));
      });
    }

    // Populates the chapter selection dropdown based on the selected book
    function populateChapters() {
      chapterSelect.innerHTML = ""; // Clear existing options
      const chapters = bibleData[bookSelect.value] || {};
      Object.keys(chapters).sort((a, b) => parseInt(a) - parseInt(b)).forEach(ch => {
        chapterSelect.add(new Option("Pasal " + ch, ch));
      });
      // Set current chapter to the first available after repopulating
      currentChapter = chapterSelect.value;
      populateVerses(); // Then populate verses for the new chapter
    }

    // Populates the verse selection dropdown based on the selected book and chapter
    function populateVerses() {
      verseSelect.innerHTML = ""; // Clear existing options
      const verses = bibleData[bookSelect.value][chapterSelect.value] || {};
      Object.keys(verses).sort((a, b) => parseInt(a) - parseInt(b)).forEach(v => {
        verseSelect.add(new Option("Ayat " + v, v));
      });
      // Set current verse to the first available after repopulating
      currentVerse = verseSelect.value;
    }

    // Displays the currently selected verse
    function showVerse() {
      currentBook = bookSelect.value;
      currentChapter = chapterSelect.value;
      currentVerse = verseSelect.value;

      if (currentBook && currentChapter && currentVerse && bibleData[currentBook] && bibleData[currentBook][currentChapter]) {
        const text = bibleData[currentBook][currentChapter][currentVerse];
        verseDisplay.innerHTML = `
          <p class="text-2xl md:text-3xl lg:text-4xl leading-relaxed drop-shadow">
            ${currentBook} ${currentChapter}:${currentVerse} - ${text}
          </p>`;
      } else {
        verseDisplay.innerHTML = `<p class="text-xl drop-shadow">Pilih Kitab, Pasal, dan Ayat</p>`;
      }
    }

    // Navigates to the next verse
    function goToNextVerse() {
      if (!currentBook || !currentChapter || !currentVerse) return;

      const currentBookChapters = bibleData[currentBook];
      const currentChapterVerses = currentBookChapters[currentChapter];
      const verseNumbers = Object.keys(currentChapterVerses).map(Number).sort((a, b) => a - b);
      const chapterNumbers = Object.keys(currentBookChapters).map(Number).sort((a, b) => a - b);
      const bookNames = Object.keys(bibleData);

      const currentVerseIndex = verseNumbers.indexOf(Number(currentVerse));
      const currentChapterIndex = chapterNumbers.indexOf(Number(currentChapter));
      const currentBookIndex = bookNames.indexOf(currentBook);

      if (currentVerseIndex < verseNumbers.length - 1) {
        // Move to the next verse in the current chapter
        currentVerse = String(verseNumbers[currentVerseIndex + 1]);
      } else if (currentChapterIndex < chapterNumbers.length - 1) {
        // Move to the next chapter (first verse)
        currentChapter = String(chapterNumbers[currentChapterIndex + 1]);
        const nextChapterVerses = Object.keys(currentBookChapters[currentChapter]).map(Number).sort((a, b) => a - b);
        currentVerse = String(nextChapterVerses[0]);
        chapterSelect.value = currentChapter; // Update chapter dropdown
        populateVerses(); // Repopulate verses for new chapter
      } else if (currentBookIndex < bookNames.length - 1) {
        // Move to the next book (first chapter, first verse)
        currentBook = bookNames[currentBookIndex + 1];
        bookSelect.value = currentBook; // Update book dropdown
        populateChapters(); // Repopulate chapters for new book
        currentChapter = Object.keys(bibleData[currentBook]).map(Number).sort((a, b) => a - b)[0]; // Set to first chapter
        chapterSelect.value = currentChapter; // Update chapter dropdown
        populateVerses(); // Repopulate verses for new chapter
        currentVerse = Object.keys(bibleData[currentBook][currentChapter]).map(Number).sort((a, b) => a - b)[0]; // Set to first verse
      }

      verseSelect.value = currentVerse; // Update verse dropdown
      showVerse(); // Display the new verse
    }

    // Navigates to the previous verse
    function goToPrevVerse() {
      if (!currentBook || !currentChapter || !currentVerse) return;

      const currentBookChapters = bibleData[currentBook];
      const currentChapterVerses = currentBookChapters[currentChapter];
      const verseNumbers = Object.keys(currentChapterVerses).map(Number).sort((a, b) => a - b);
      const chapterNumbers = Object.keys(currentBookChapters).map(Number).sort((a, b) => a - b);
      const bookNames = Object.keys(bibleData);

      const currentVerseIndex = verseNumbers.indexOf(Number(currentVerse));
      const currentChapterIndex = chapterNumbers.indexOf(Number(currentChapter));
      const currentBookIndex = bookNames.indexOf(currentBook);

      if (currentVerseIndex > 0) {
        // Move to the previous verse in the current chapter
        currentVerse = String(verseNumbers[currentVerseIndex - 1]);
      } else if (currentChapterIndex > 0) {
        // Move to the previous chapter (last verse)
        currentChapter = String(chapterNumbers[currentChapterIndex - 1]);
        const prevChapterVerses = Object.keys(currentBookChapters[currentChapter]).map(Number).sort((a, b) => a - b);
        currentVerse = String(prevChapterVerses[prevChapterVerses.length - 1]);
        chapterSelect.value = currentChapter; // Update chapter dropdown
        populateVerses(); // Repopulate verses for new chapter
      } else if (currentBookIndex > 0) {
        // Move to the previous book (last chapter, last verse)
        currentBook = bookNames[currentBookIndex - 1];
        bookSelect.value = currentBook; // Update book dropdown
        populateChapters(); // Repopulate chapters for new book
        currentChapter = Object.keys(bibleData[currentBook]).map(Number).sort((a, b) => a - b)[Object.keys(bibleData[currentBook]).length - 1]; // Set to last chapter
        chapterSelect.value = currentChapter; // Update chapter dropdown
        populateVerses(); // Repopulate verses for new chapter
        currentVerse = Object.keys(bibleData[currentBook][currentChapter]).map(Number).sort((a, b) => a - b)[Object.keys(bibleData[currentBook][currentChapter]).length - 1]; // Set to last verse
      }

      verseSelect.value = currentVerse; // Update verse dropdown
      showVerse(); // Display the new verse
    }

    // Event listeners for dropdown changes
    bookSelect.addEventListener("change", () => {
      populateChapters();
      showVerse();
    });

    chapterSelect.addEventListener("change", () => {
      populateVerses();
      showVerse();
    });

    verseSelect.addEventListener("change", showVerse);

    // Load Bible data when the page loads
    window.onload = loadBible;
  </script>
</body>
</html>
